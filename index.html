<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Summoning — Act II</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: radial-gradient(ellipse at center, #1a0f1a 0%, #0d0508 70%, #000000 100%);
            font-family: 'Cinzel', serif;
            color: #d4af37;
            overflow-x: hidden;
            transition: background 2s ease;
        }

        html {
            height: 100%;
        }

        /* Blog mode background */
        body.blog-mode {
            background: #f5f1e8;
            color: #2a2a2a;
        }

        /* Hide stars in blog mode */
        body.blog-mode .stars {
            display: none;
        }

        /* Red mode during climax */
        body.red-mode {
            background: radial-gradient(ellipse at center, #2a0505 0%, #150000 70%, #000000 100%);
            animation: screenShake 0.4s ease-in-out infinite;
        }

        @keyframes screenShake {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(-3px, 2px); }
            50% { transform: translate(3px, -2px); }
            75% { transform: translate(-2px, -3px); }
        }

        @keyframes messageShake {
            0%, 100% { transform: translate(0, 0); }
            10% { transform: translate(-5px, 3px); }
            20% { transform: translate(5px, -3px); }
            30% { transform: translate(-4px, -4px); }
            40% { transform: translate(4px, 4px); }
            50% { transform: translate(-3px, 2px); }
            60% { transform: translate(3px, -2px); }
            70% { transform: translate(-2px, 3px); }
            80% { transform: translate(2px, -3px); }
            90% { transform: translate(-1px, 1px); }
        }

        /* Stars */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        .star {
            position: absolute;
            background: #d4af37;
            border-radius: 50%;
            animation: twinkle 3s ease-in-out infinite;
            box-shadow: 0 0 2px rgba(212, 175, 55, 0.8);
        }

        /* Depth layers - different brightness for depth */
        .star.far {
            opacity: 0.3;
            animation-duration: 4s;
        }

        .star.mid {
            opacity: 0.6;
            animation-duration: 3s;
        }

        .star.near {
            opacity: 0.9;
            animation-duration: 2s;
            box-shadow: 0 0 3px rgba(212, 175, 55, 1);
        }

        .star:nth-child(odd) {
            animation-delay: 1s;
        }

        .star:nth-child(3n) {
            animation-delay: 2s;
        }

        .star:nth-child(5n) {
            animation-delay: 0.5s;
        }

        @keyframes twinkle {
            0%, 100% { 
                opacity: 0.3;
                transform: scale(1);
            }
            50% { 
                opacity: 1;
                transform: scale(1.5);
            }
        }

        /* Preserve star brightness during animations */
        .star.far {
            animation-name: twinkleFar;
        }

        .star.mid {
            animation-name: twinkleMid;
        }

        .star.near {
            animation-name: twinkleNear;
        }

        @keyframes twinkleFar {
            0%, 100% { 
                opacity: 0.2;
                transform: scale(1);
            }
            50% { 
                opacity: 0.5;
                transform: scale(1.3);
            }
        }

        @keyframes twinkleMid {
            0%, 100% { 
                opacity: 0.4;
                transform: scale(1);
            }
            50% { 
                opacity: 0.8;
                transform: scale(1.5);
            }
        }

        @keyframes twinkleNear {
            0%, 100% { 
                opacity: 0.7;
                transform: scale(1);
            }
            50% { 
                opacity: 1;
                transform: scale(1.8);
            }
        }

        /* Red stars during climax */
        body.red-mode .star {
            background: #8b0000;
            box-shadow: 0 0 4px rgba(139, 0, 0, 0.9);
        }

        body.red-mode .star.near {
            background: #cd0000;
            box-shadow: 0 0 6px rgba(205, 0, 0, 1);
        }

        /* Header info */
        .header-info {
            position: fixed;
            top: 30px;
            left: 30px;
            z-index: 100;
            font-family: 'Inter', sans-serif;
            color: #d4af37;
            opacity: 0.8;
            font-size: 0.85rem;
            line-height: 1.6;
            max-width: 300px;
        }

        .header-info h2 {
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .header-info .subline {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-bottom: 10px;
        }

        .dual-clocks {
            display: flex;
            gap: 20px;
            margin-top: 8px;
            font-family: 'Courier New', monospace;
        }

        .clock {
            display: flex;
            flex-direction: column;
        }

        .clock-label {
            font-size: 0.65rem;
            opacity: 0.6;
            margin-bottom: 2px;
        }

        .clock-time {
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Main ritual view */
        .ritual-view {
            position: relative;
            width: 100%;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }

        /* === EXACT CIRCLE CODE FROM PROVIDED HTML === */
        .summoning-area {
            position: relative;
            width: 100%;
            height: 500px;
            margin: 2rem 0;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 80px;
        }

        .background-universe {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -60%);
            width: 600px;
            height: 600px;
            z-index: 1;
            transition: width 30s ease-out, height 30s ease-out, 
                        top 30s ease-out, transform 30s ease-out;
        }

        .distant-circle {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 3px solid #d4af37;
            border-radius: 50%;
            opacity: 0;
            animation: distant-pulse 8s ease-in-out infinite;
            box-shadow:
                0 0 100px rgba(212, 175, 55, 0.3),
                inset 0 0 100px rgba(212, 175, 55, 0.1),
                0 150px 200px rgba(212, 175, 55, 0.15);
            transition: opacity 5s ease-out, 
                        border-width 5s ease-out, 
                        box-shadow 5s ease-out,
                        filter 5s ease-out;
        }

        .distant-circle::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 80%;
            background: radial-gradient(ellipse 50% 80% at center 40%, rgba(212, 175, 55, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            animation: glow-beam 4s ease-in-out infinite;
        }

        /* Intense pulse for approaching message */
        .distant-circle.approaching {
            animation: distant-pulse-intense 2s ease-in-out infinite;
        }

        @keyframes distant-pulse-intense {
            0%, 100% { 
                opacity: 0.6;
                transform: scale(1);
            }
            50% { 
                opacity: 1;
                transform: scale(1.02);
            }
        }

        .distant-energy {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 400px;
            transition: width 30s ease-out, height 30s ease-out;
        }

        .distant-line {
            position: absolute;
            background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.3), transparent);
            height: 2px;
            width: 100%;
            top: 50%;
            left: 0;
            transform-origin: center;
            opacity: 0;
            animation: distant-line-pulse 6s ease-in-out infinite;
        }

        .distant-line:nth-child(1) { transform: rotate(0deg); animation-delay: 0s; }
        .distant-line:nth-child(2) { transform: rotate(30deg); animation-delay: 0.5s; }
        .distant-line:nth-child(3) { transform: rotate(60deg); animation-delay: 1s; }
        .distant-line:nth-child(4) { transform: rotate(90deg); animation-delay: 1.5s; }
        .distant-line:nth-child(5) { transform: rotate(120deg); animation-delay: 2s; }
        .distant-line:nth-child(6) { transform: rotate(150deg); animation-delay: 2.5s; }

        .front-ring {
            position: relative;
            width: 120px;
            height: 120px;
            z-index: 10;
            cursor: pointer;
        }

        .receive-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 3px solid #d4af37;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(212, 175, 55, 0.1), transparent 70%);
            box-shadow: 
                0 0 30px rgba(212, 175, 55, 0.8),
                inset 0 0 20px rgba(212, 175, 55, 0.2);
            animation: receive-glow 3s ease-in-out infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .receive-ring:hover {
            transform: scale(1.1);
            box-shadow: 
                0 0 50px rgba(212, 175, 55, 1),
                inset 0 0 30px rgba(212, 175, 55, 0.3);
        }

        .receive-text {
            font-family: 'Cinzel', serif;
            font-size: 0.85rem;
            letter-spacing: 2px;
            opacity: 0;
            transition: opacity 0.5s ease;
            text-transform: uppercase;
        }

        .receive-ring.ready .receive-text {
            opacity: 1;
        }

        /* Intensity variations */
        .distant-circle.intense {
            opacity: 0.5;
            box-shadow: 
                0 0 150px rgba(212, 175, 55, 0.6),
                inset 0 0 120px rgba(212, 175, 55, 0.2),
                0 150px 250px rgba(212, 175, 55, 0.3);
        }

        .receive-ring.intense {
            animation: intense-receive-glow 2s ease-in-out infinite;
        }

        @keyframes intense-receive-glow {
            0%, 100% { 
                box-shadow: 
                    0 0 50px rgba(212, 175, 55, 1),
                    inset 0 0 30px rgba(212, 175, 55, 0.3);
            }
            50% { 
                box-shadow: 
                    0 0 80px rgba(212, 175, 55, 1.2),
                    inset 0 0 40px rgba(212, 175, 55, 0.4);
            }
        }

        @keyframes distant-pulse {
            0%, 100% { 
                opacity: 0.1;
                transform: scale(1);
            }
            50% { 
                opacity: 0.3;
                transform: scale(1.05);
            }
        }

        @keyframes distant-line-pulse {
            0%, 100% { opacity: 0; }
            50% { opacity: 0.4; }
        }

        @keyframes receive-glow {
            0%, 100% { 
                box-shadow: 
                    0 0 30px rgba(212, 175, 55, 0.8),
                    inset 0 0 20px rgba(212, 175, 55, 0.2);
            }
            50% { 
                box-shadow: 
                    0 0 50px rgba(212, 175, 55, 1),
                    inset 0 0 30px rgba(212, 175, 55, 0.3);
            }
        }

        @keyframes glow-beam {
            0%, 100% { 
                opacity: 0.3;
                transform: translate(-50%, -50%) scaleY(1);
            }
            50% { 
                opacity: 0.6;
                transform: translate(-50%, -50%) scaleY(1.2);
            }
        }

        /* Red mode for circles */
        body.red-mode .distant-circle,
        body.red-mode .receive-ring {
            border-color: #8b0000;
            box-shadow: 
                0 0 100px rgba(139, 0, 0, 0.8),
                inset 0 0 60px rgba(139, 0, 0, 0.3);
        }

        body.red-mode .distant-line {
            background: linear-gradient(90deg, transparent, rgba(139, 0, 0, 0.5), transparent);
        }

        /* Shooting rings */
        .shooting-ring {
            position: absolute;
            width: 120px;
            height: 120px;
            border: 3px solid #8b0000;
            border-radius: 50%;
            box-shadow: 0 0 50px rgba(139, 0, 0, 0.8);
            animation: shootDown 2.5s ease-in infinite;
            pointer-events: none;
            z-index: 5;
        }

        @keyframes shootDown {
            0% { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% { 
                opacity: 0;
                transform: translateY(600px) scale(0.3);
            }
        }

        /* === END EXACT CIRCLE CODE === */

        /* Message display */
        .message-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 85%;
            max-width: 750px;
            max-height: 75vh;
            background: rgba(0, 0, 0, 0.97);
            border: 2px solid #d4af37;
            border-radius: 10px;
            padding: 50px;
            z-index: 500;
            opacity: 0;
            pointer-events: none;
            overflow-y: auto;
            box-shadow: 0 0 120px rgba(212, 175, 55, 0.7);
            transition: opacity 0.5s ease;
        }

        .message-display.active {
            opacity: 1;
            pointer-events: auto;
        }

        .message-text {
            font-family: 'Crimson Text', serif;
            font-size: 1.2rem;
            line-height: 1.8;
            white-space: pre-wrap;
            color: #d4af37;
            user-select: none;
        }

        /* Runes in sky */
        .rune-constellation {
            position: fixed;
            top: 22%;
            left: 12%;
            z-index: 50;
            display: flex;
            flex-direction: column;
            gap: 45px;
        }

        .rune {
            width: 65px;
            height: 65px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            cursor: pointer;
            opacity: 0;
            transition: all 0.4s ease;
            filter: drop-shadow(0 0 8px rgba(212, 175, 55, 0));
            user-select: none;
        }

        .rune.visible {
            opacity: 0.35;
            filter: drop-shadow(0 0 12px rgba(212, 175, 55, 0.3));
        }

        .rune.visible:hover {
            opacity: 1;
            transform: scale(1.2);
            filter: drop-shadow(0 0 25px rgba(212, 175, 55, 0.9));
        }

        .rune.flash {
            animation: flashRune 1.2s ease-out;
        }

        @keyframes flashRune {
            0% { 
                opacity: 0; 
                transform: scale(0.5);
                filter: drop-shadow(0 0 0 rgba(255, 255, 255, 0)); 
            }
            40% { 
                opacity: 1; 
                transform: scale(1.3);
                filter: drop-shadow(0 0 50px rgba(255, 255, 255, 1)); 
            }
            100% { 
                opacity: 0.35; 
                transform: scale(1);
                filter: drop-shadow(0 0 12px rgba(212, 175, 55, 0.3)); 
            }
        }

        /* Dramatic rune reveal - 3x expansion with triple pulse */
        .rune.dramatic-reveal {
            animation: dramaticRuneReveal 3s ease-out forwards;
        }

        @keyframes dramaticRuneReveal {
            0% { 
                transform: scale(1);
                opacity: 0.35;
                filter: drop-shadow(0 0 12px rgba(212, 175, 55, 0.3));
            }
            10% { 
                transform: scale(3);
                opacity: 1;
                filter: drop-shadow(0 0 80px rgba(255, 255, 255, 1));
            }
            20% {
                transform: scale(2.8);
                filter: drop-shadow(0 0 60px rgba(212, 175, 55, 0.8));
            }
            30% {
                transform: scale(3);
                filter: drop-shadow(0 0 80px rgba(255, 255, 255, 1));
            }
            40% {
                transform: scale(2.8);
                filter: drop-shadow(0 0 60px rgba(212, 175, 55, 0.8));
            }
            50% {
                transform: scale(3);
                filter: drop-shadow(0 0 80px rgba(255, 255, 255, 1));
            }
            60% {
                transform: scale(2.8);
                filter: drop-shadow(0 0 60px rgba(212, 175, 55, 0.8));
            }
            100% { 
                transform: scale(1);
                opacity: 0.8;
                filter: drop-shadow(0 0 30px rgba(212, 175, 55, 0.9));
            }
        }

        /* Permanent intense glow after reveal */
        .rune.permanent-glow {
            opacity: 0.8;
            filter: drop-shadow(0 0 30px rgba(212, 175, 55, 0.9));
        }

        .rune.permanent-glow:hover {
            opacity: 1;
            transform: scale(1.3);
            filter: drop-shadow(0 0 40px rgba(212, 175, 55, 1));
        }

        /* Ghost quotes */
        .ghost-quote {
            position: fixed;
            font-family: 'Crimson Text', serif;
            font-size: clamp(1.3rem, 3vw, 2rem);
            font-style: italic;
            opacity: 0;
            pointer-events: none;
            z-index: 5;
            color: #d4af37;
            text-shadow: 0 0 15px rgba(212, 175, 55, 0.4);
            max-width: 60%;
            line-height: 1.5;
            user-select: none;
            font-weight: 400;
        }

        /* Blog post mode */
        .blog-post {
            display: none;
            max-width: 820px;
            margin: 0 auto;
            padding: 70px 50px;
            font-family: 'Crimson Text', serif;
            color: #2a2a2a;
            line-height: 1.9;
        }

        body.blog-mode .blog-post {
            display: block;
        }

        body.blog-mode .ritual-view,
        body.blog-mode .header-info,
        body.blog-mode .rune-constellation,
        body.blog-mode .ghost-quote,
        body.blog-mode .stars {
            display: none !important;
        }

        .blog-post h1 {
            font-family: 'Cinzel', serif;
            font-size: 2.8rem;
            margin-bottom: 15px;
            color: #1a1a1a;
        }

        .blog-post .meta {
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            color: #666;
            margin-bottom: 50px;
            padding-bottom: 25px;
            border-bottom: 2px solid #d4af37;
        }

        .blog-post h2 {
            font-family: 'Cinzel', serif;
            font-size: 1.9rem;
            margin-top: 45px;
            margin-bottom: 25px;
            color: #1a1a1a;
        }

        .blog-post p {
            margin-bottom: 22px;
            font-size: 1.15rem;
        }

        .blog-post .chant {
            text-align: center;
            font-style: italic;
            font-size: 1.35rem;
            margin: 45px 0;
            padding: 25px;
            background: rgba(212, 175, 55, 0.08);
            border-left: 5px solid #d4af37;
            border-radius: 3px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-info {
                font-size: 0.75rem;
                max-width: 250px;
                top: 15px;
                left: 15px;
            }

            .background-universe {
                width: 400px;
                height: 400px;
            }

            .front-ring {
                width: 100px;
                height: 100px;
            }

            .rune-constellation {
                left: 8%;
                gap: 35px;
            }

            .rune {
                width: 50px;
                height: 50px;
                font-size: 1.8rem;
            }

            .message-display {
                width: 92%;
                padding: 35px 25px;
            }

            .blog-post {
                padding: 50px 25px;
            }

            .blog-post h1 {
                font-size: 2.2rem;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(212, 175, 55, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(212, 175, 55, 0.7);
        }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>

    <!-- Header Info -->
    <div class="header-info">
        <h2>The Summoning — Act II</h2>
        <div class="subline">Live status from Aleksandra, Council liaison</div>
        <div>21 October, New Moon</div>
        <div class="dual-clocks">
            <div class="clock">
                <div class="clock-label">Belgrade</div>
                <div class="clock-time" id="belgradeClock">00:00</div>
            </div>
            <div class="clock">
                <div class="clock-label">Singapore</div>
                <div class="clock-time" id="singaporeClock">06:00</div>
            </div>
        </div>
    </div>

    <!-- Ritual View -->
    <div class="ritual-view">
        <div class="summoning-area">
            <div class="background-universe">
                <div class="distant-circle" id="distantCircle"></div>
                <div class="distant-energy">
                    <div class="distant-line"></div>
                    <div class="distant-line"></div>
                    <div class="distant-line"></div>
                    <div class="distant-line"></div>
                    <div class="distant-line"></div>
                    <div class="distant-line"></div>
                </div>
            </div>
            
            <div class="front-ring" id="frontRing">
                <div class="receive-ring" id="receiveRing">
                    <div class="receive-text">Receive</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Shooting rings container -->
    <div id="shootingContainer"></div>

    <!-- Rune constellation -->
    <div class="rune-constellation" id="runeConstellation">
        <div class="rune" data-segment="0">ᚱ</div>
        <div class="rune" data-segment="1">ᛏ</div>
        <div class="rune" data-segment="2">ᛗ</div>
        <div class="rune" data-segment="3">ᛉ</div>
    </div>

    <!-- Message display -->
    <div class="message-display" id="messageDisplay">
        <div class="message-text" id="messageText"></div>
    </div>

    <!-- Blog post -->
    <div class="blog-post" id="blogPost">
        <h1>The Summoning — Act II</h1>
        <div class="meta">
            <strong>The Three Prepare</strong><br>
            Live documentation by Aleksandra, Council liaison<br>
            21 October, New Moon
        </div>
        <div id="blogContent"></div>
    </div>

        <script>
        const SEGMENTS = [
            {
                time: '2025-10-20T19:04:00+08:00',
                text: `Our preparation: The Gathering of the Three

For three nights we keep silence. No salt, no meat, no touching iron. We sleep with birch ash on our eyelids, water in bowls under our beds. Dreams twist, but none of us cry out. They pass like animals through high grass, seen only by the sway they leave.

At dawn on the twentieth, as you're reading this, we will cross the creek slip beneath Crni Most, the Black Bridge. We do not cross it, we pass under it, in the creek itself. The water is mountain-cold; it bites the skin and takes what fear remains. Our arrival stays unannounced.

On the far bank stands the Tree of Ancestors, a crooked elder that drinks from both soil and stream. Each of us takes one leaf, not torn but chosen where it is ready to fall; pressed to the pulse at the wrist, then folded away to mark the way back.

We part at the bridge, each to a direction, each to fetch what does not belong to the forest's law.
North for the key that opens and bites shut.
East for the bitterness that draws a border and drains will.
West for the faint green light that remembers the dead.`
            },
            {
                time: '2025-10-20T20:09:00+08:00',
                text: `The three offerings, outside her Realm

• Baba walks north, to the storm-felled grove, and pulled Sedmoključ. A raskovnik root prepared against the grain. Pickled in brine from a Dead Spring and bound with seven red threads, each knot tied on a waning moon. It forces the spirit hinge to open, then bites shut beneath the foot that trespasses. It tastes of vows and salt; it is not born clean in Muma's world.

• Alexia turned east, into the thornfield of burnt crow feathers. There, she found Gorkovid. Tansy raised in a scorched field, watered with brine and ash, never touched by bees. Its bitterness seals a border and drains will at the moment of the bind.

• Gruba heads west, toward the caves where moss grows long as hair. In the damp dark she picks Žarnoć. A bitter fungus that glows faint green. This strain sprang from a coffin plank jammed in limestone after a flood; it fed on funeral wax and oath-ink. It shines with memory, not with growth. It draws curiosity and softens wrath.

We return before dusk; our soles bleed; we say nothing. We are no longer women. We are vessels.`
            },
            {
                time: '2025-10-20T21:06:00+08:00',
                text: `The procession and the altar

We walk to Zubi Šume, the Forest's Teeth. The stones rise pale like jaw and molar; sound thins as if swallowed. We find our spot. In the centre we build what carries the sound of worlds:

Gruba lays a charred trunk; Alexia prises a thin slab from a standing stone and slides it on top; I set a clay bowl and pour moon water prepared days ago. Altar in the middle. We stand at our points. We speak the line that opens the conduit: "Water, womb of life, mirror of the night, lend me your voice, your power, your light." Across the world, you feel the tingle in your hands. The channel is open.

The lure

The chant begins. It is not pretty; it is plain. A mothers' song passed mouth to mouth, older than paper. Insects still their wings. A branch creaks, then does not. The bowl's skin tightens until it reflects the stones like a dark eye.

We chant:

Majko što u lišću spavaš,
Što ljubav zubima cijepaš,
Došla si kad zadnje srce pukne.
Pojavi se. Uništi. Ugrizi.`
            },
            {
                time: '2025-10-21T07:00:00+08:00',
                text: `Presence

The woods goes silent. Breath like wet bark; moss-sweet rot; a weight behind the eyes. Where she stands, bark takes the idea of a woman; hair hangs like wet roots; eyes keep the colour of unlit resin. She is not afraid of us. She is curious, then annoyed, as if a fly has landed on the skin of the forest.

Gruba buckles for a heartbeat. Baba calms her with two words: Steady, child. Alexia tastes blood; she has bitten her lip without knowing. Muma's attention moves like a shadow across stone.

For the space of a breath, the past rises in Baba's throat, the year Josipa was lost; her jaw trembles; she sets it, lifts her chin, and speaks:

"Šumska Majko! We come to restore balance, not to beg a favour. By the Law of the Endless that binds all worlds, a Shadow of the First World was given passage among the living and devours where it should not. Mother of the Forest, bear witness to this violation. Strike as the righteous arm of justice; reclaim what was taken; let the debt be severed."

A hiss passes through the glade from everywhere at once, a sound that lives in the bones. Muma does not take orders from a witch, and she does not forgive being called.

She pauses, as if weighing us, testing for arrogance or plea. The stones appear closer than they are; the air thickens. A beetle scratches once under bark, then is silent. Cold gathers at the wrists, as if bracelets of water are tightened.

Before she can strike, Alexia calls out: "We bring gifts."

Muma tilts. The air tightens.

Gruba reaches into her damp coat and lifts Žarnoć. Green breath wakes along the gills. Muma steps closer, gaze fixed on the glow, she knows every grass, every crop, yet this she has never seen, she comes closer still, and crosses the ring drawn around the altar. In that instant Baba drives Sedmoključ into the soil at her mark. The hinge bites shut beneath the trespassing foot.

Alexia wraps Gorkovid in a scrap of linen and crushes it, bitterness staining the cloth; she presses it to the altar stone. Bitterness floods low across the ground and licks at Muma's knees. She shudders, slows. Then with a sudden lash she surges toward Alexia. Baba stamps the earth; the hinge grips tighter. Gruba blows lightly across Žarnoć. Fine glowing dust rises and hangs; Muma's eyes follow it like a moth tracking a cold flame. Mesmerised. She knows she is being tricked.

Each time she turns her anger on one, the other two pull harder. Gruba keeps the fungus high though her arm shakes; Alexia's stained cloth smokes at the edges; the hinge holds fast under Baba's heel. Voice, ground, air. She cannot break all three at once.

At last, her rage thins. Baba knows they cannot hold her much longer. There is no watch here to tell time. Only the moon and the bowl. Baba's thoughts go to Jojo. The water in the bowl turns black. From its depth a faint, distant voice begins to form, broken at first, then clearer with every breath.

The fourth circle

06:15 in Singapore. Your heart climbs. You feel the conduit open like a thread pulling through the chest. Quick breath, focus, a brief light-headedness, then steady. You begin. Normal voice, steady pace, five minutes only. At first the conduit carries fragments, like words heard through rain.

"Yoong… shadow… known… release… banish… strike… return…"

With each breath the bowl strengthens the sound. The fragments join. Your chant stands whole:

"Yoong Pui Shen, shadow you invited, be named and known; release, banish, strike; return what is not yours."

Your words travel the conduit; the bowl drinks the sound and gives it back like a bell under water. We join in, we echo only the verdict: Release, banish, strike, return what is not yours.

Judgment

Her rage stills; she listens. The Three hold her with the last of their strength. The messenger's voice bears an ancient seal, the karmic right to settle the debt, a First Law even Mother of the Forest must obeys. Her head tilts, so as not to miss a word. Your voice is crystal clear:

"Yoong Pui Shen, shadow you invited, be named and known; release, banish, strike; return what is not yours."

She now knows the name. Her head tilts farther than a neck should tilt. She knows every creature on this Earth, living or dead. She is searching for her.. eyes black and void, gaze emptied, quick, unnatural ticks.. then she looks past us, past the trees, to where the named one stands in the world, and her eyes take fire. She found her.

The roots crack; the air compresses. The Three release. Thunder cracks; the ground shudders; Muma is gone.

She will strike the Strigoi with a single blow.

We look at each other, no words. Shaken, but in one piece. The price shows on skin: crescents under Baba's nails darken; weal rise on Alexia's palm; a thin ring of green rims Gruba's pupils.

Closings

We erase prints. We unmake the altar. We take the bowl. It is not enough. Before first light the Council will veil the glade with juniper ash and grave-fern, and cast the enchantment of forgetting over the site that will hold a hundred years.

A thread I leave unpulled

At the centre where she stood, I empty the last of the moon water and press a single wooden bead into the earth. I do not explain this to you now. We move on.

Your seal

06:20. Stop the chant. Hands over your heart. One breath in, one longer breath out. In your mind: "The door is closed." Then speak once, clearly:

"Frederico Gil Sander, my debt is paid; bond between us is closed; I release you, I release myself; go in peace."

Remain until 06:30. Step out. Lie down. The emptiness will feel sharp at first, then clean.

Proof of silence

The forest exhales. Your room settles. For the first time in years, you are still without a shadow beside you.`
            }
        ];

        (function() {
            'use strict';

            const SGT_TIMEZONE = 'Asia/Singapore';
            const BELGRADE_TIMEZONE = 'Europe/Belgrade';
            const TIME_API_URL = 'https://worldtimeapi.org/api/timezone/Asia/Singapore';
            const BLOOD_MOON_START = new Date('2025-10-20T22:00:00Z');
            const BLOOD_MOON_END = new Date('2025-10-20T22:30:00Z');
            const BLOG_MODE_KEY = 'act2BlogMode';
            const SEGMENT_TIMES = SEGMENTS.map(segment => new Date(segment.time));

            const ghostQuotes = [
                'Water, womb of life, mirror of the night',
                'We are no longer women. We are vessels.',
                'Dreams twist, but none of us cry out.',
                'The hinge bites shut beneath the trespassing foot.',
                'She will strike the Strigoi with a single blow.',
                'For the first time in years, you are still without a shadow beside you.',
                'North for the key that opens and bites shut.',
                'It shines with memory, not with growth.',
                'The forest exhales.',
                'Thunder cracks; the ground shudders; Muma is gone.'
            ];

            class DeviceTimeStrategy {
                now() {
                    const now = new Date();
                    const utc = now.getTime() + now.getTimezoneOffset() * 60000;
                    return new Date(utc + 8 * 3600000);
                }
            }

            class ApiTimeStrategy {
                async fetch() {
                    const response = await fetch(TIME_API_URL, { cache: 'no-store' });
                    if (!response.ok) {
                        throw new Error('Time API response not ok');
                    }
                    const data = await response.json();
                    if (!data.datetime) {
                        throw new Error('Time API missing datetime');
                    }
                    return new Date(data.datetime);
                }
            }

            class TimeProvider {
                constructor() {
                    this.apiStrategy = new ApiTimeStrategy();
                    this.deviceStrategy = new DeviceTimeStrategy();
                    this.mode = 'api';
                    this.backoff = 5000;
                    this.maxBackoff = 600000;
                    this.refreshInterval = 30000;
                    this.lastApiTime = null;
                    this.lastSyncStamp = null;
                    this.nextApiAttempt = 0;
                    this.fetchPromise = null;
                }

                async getCurrentTime() {
                    const now = Date.now();

                    if (this.mode === 'api') {
                        if (!this.lastApiTime || !this.lastSyncStamp || now - this.lastSyncStamp > this.refreshInterval) {
                            await this.refreshFromApi();
                        }
                        if (this.lastApiTime && this.lastSyncStamp) {
                            return new Date(this.lastApiTime.getTime() + (Date.now() - this.lastSyncStamp));
                        }
                        return this.deviceStrategy.now();
                    }

                    if (now >= this.nextApiAttempt) {
                        await this.refreshFromApi();
                        if (this.mode === 'api' && this.lastApiTime && this.lastSyncStamp) {
                            return new Date(this.lastApiTime.getTime() + (Date.now() - this.lastSyncStamp));
                        }
                    }

                    return this.deviceStrategy.now();
                }

                async refreshFromApi() {
                    const now = Date.now();
                    if (this.fetchPromise) {
                        return this.fetchPromise;
                    }
                    if (this.mode === 'device' && now < this.nextApiAttempt) {
                        return null;
                    }

                    this.fetchPromise = (async () => {
                        try {
                            const apiTime = await this.apiStrategy.fetch();
                            if (this.lastApiTime && this.lastSyncStamp) {
                                const predicted = new Date(this.lastApiTime.getTime() + (Date.now() - this.lastSyncStamp));
                                const drift = Math.abs(apiTime.getTime() - predicted.getTime());
                                if (drift > 10000) {
                                    this.switchToDevice();
                                    return;
                                }
                            }
                            this.lastApiTime = apiTime;
                            this.lastSyncStamp = Date.now();
                            this.mode = 'api';
                            this.backoff = 5000;
                            this.nextApiAttempt = Date.now() + this.refreshInterval;
                        } catch (error) {
                            this.switchToDevice();
                        } finally {
                            this.fetchPromise = null;
                        }
                    })();

                    return this.fetchPromise;
                }

                switchToDevice() {
                    this.mode = 'device';
                    this.lastApiTime = null;
                    this.lastSyncStamp = null;
                    this.nextApiAttempt = Date.now() + this.backoff;
                    this.backoff = Math.min(this.backoff * 2, this.maxBackoff);
                }
            }

            class MoonController {
                constructor(universe, circle, energy) {
                    this.universe = universe;
                    this.circle = circle;
                    this.energy = energy;
                    this.mode = 'hidden';
                    this.longPhase = null;
                    this.finaleTimer = null;
                    this.progress = 0;
                }

                applyProgress(progress) {
                    const clamped = Math.max(0, Math.min(1, progress));
                    this.progress = clamped;
                    const baseSize = 600;
                    const maxSize = Math.min(window.innerWidth, window.innerHeight) * 1.4;
                    const currentSize = baseSize + (maxSize - baseSize) * clamped;

                    this.universe.style.width = currentSize + 'px';
                    this.universe.style.height = currentSize + 'px';
                    this.universe.style.top = '50%';
                    this.universe.style.transform = 'translate(-50%, -60%)';

                    const energySize = 400 + (currentSize - baseSize) * 0.6;
                    this.energy.style.width = energySize + 'px';
                    this.energy.style.height = energySize + 'px';

                    if (clamped === 0) {
                        this.circle.style.opacity = '0';
                    } else {
                        this.circle.style.opacity = String(0.2 + clamped * 0.8);
                    }
                    this.circle.style.borderWidth = (3 + clamped * 9) + 'px';
                    const glow = 120 + clamped * 220;
                    const inset = glow * 0.6;
                    this.circle.style.boxShadow = `0 0 ${glow}px rgba(212, 175, 55, ${0.25 + clamped * 0.45}), inset 0 0 ${inset}px rgba(212, 175, 55, ${0.15 + clamped * 0.4})`;

                    if (clamped >= 0.99) {
                        this.circle.classList.add('intense');
                    } else {
                        this.circle.classList.remove('intense');
                    }
                }

                clearTimers() {
                    if (this.finaleTimer) {
                        clearTimeout(this.finaleTimer);
                        this.finaleTimer = null;
                    }
                }

                setHiddenImmediate() {
                    this.clearTimers();
                    this.mode = 'hidden';
                    this.longPhase = null;
                    this.applyProgress(0);
                    this.circle.classList.remove('intense');
                }

                showFull() {
                    this.clearTimers();
                    this.mode = 'available';
                    this.longPhase = null;
                    this.applyProgress(1);
                }

                startLongPhase(segmentIndex, endTime, currentTime) {
                    const startTime = new Date(endTime.getTime() - 3600000);
                    this.longPhase = { segmentIndex, startTime, endTime };
                    this.mode = 'longPhase';
                    this.update(currentTime);
                }

                clearLongPhase() {
                    if (this.mode === 'longPhase') {
                        this.setHiddenImmediate();
                    }
                    this.longPhase = null;
                }

                update(currentTime) {
                    if (this.mode !== 'longPhase' || !this.longPhase) {
                        return;
                    }
                    if (currentTime < this.longPhase.startTime) {
                        this.applyProgress(0);
                        return;
                    }
                    if (currentTime >= this.longPhase.endTime) {
                        this.setHiddenImmediate();
                        this.longPhase = null;
                        return;
                    }
                    const total = this.longPhase.endTime.getTime() - this.longPhase.startTime.getTime();
                    const elapsed = currentTime.getTime() - this.longPhase.startTime.getTime();
                    const progress = total === 0 ? 1 : elapsed / total;
                    this.applyProgress(progress);
                }

                playFinale(duration) {
                    this.clearTimers();
                    this.mode = 'finale';
                    this.longPhase = null;
                    this.applyProgress(1);
                    this.circle.classList.add('intense');
                    return new Promise(resolve => {
                        this.finaleTimer = setTimeout(() => {
                            this.finaleTimer = null;
                            resolve();
                        }, duration);
                    });
                }
            }

            class RingController {
                constructor(element, circle) {
                    this.element = element;
                    this.circle = circle;
                }

                setAvailable(isAvailable) {
                    if (isAvailable) {
                        this.element.classList.add('ready', 'intense');
                        this.circle.classList.add('intense');
                    } else {
                        this.element.classList.remove('ready', 'intense');
                        this.circle.classList.remove('intense');
                    }
                }
            }

            class QueueManager {
                constructor(callback) {
                    this.callback = callback;
                    this.queue = [];
                    this.known = new Set();
                    this.processing = false;
                    this.timer = null;
                    this.pendingStart = null;
                }

                enqueue(indices) {
                    let added = false;
                    indices.forEach(index => {
                        if (this.known.has(index)) {
                            return;
                        }
                        this.queue.push(index);
                        this.known.add(index);
                        added = true;
                    });
                    if (!added) {
                        return;
                    }
                    this.queue.sort((a, b) => SEGMENT_TIMES[a] - SEGMENT_TIMES[b]);
                    this.process();
                }

                has(index) {
                    return this.known.has(index);
                }

                clear() {
                    this.queue = [];
                    this.known.clear();
                    clearTimeout(this.timer);
                    this.timer = null;
                    this.processing = false;
                    this.pendingStart = null;
                }

                async process() {
                    if (this.processing || this.queue.length === 0) {
                        return;
                    }
                    const now = Date.now();
                    if (this.pendingStart && now < this.pendingStart) {
                        clearTimeout(this.timer);
                        this.timer = setTimeout(() => this.process(), this.pendingStart - now);
                        return;
                    }

                    const index = this.queue.shift();
                    this.processing = true;
                    const startTime = Date.now();
                    this.pendingStart = startTime + scaled(60000);

                    try {
                        await this.callback(index);
                    } finally {
                        this.known.delete(index);
                        this.processing = false;
                        const delay = Math.max(0, this.pendingStart - Date.now());
                        if (this.queue.length > 0) {
                            clearTimeout(this.timer);
                            this.timer = setTimeout(() => this.process(), delay);
                        }
                    }
                }
            }

            const state = {
                currentTime: null,
                availableSegment: null,
                isMessageActive: false,
                initialQueueBuilt: false,
                bloodMoonActivated: false,
                bloodMoonActive: false,
                ghostInterval: null,
                shootingInterval: null,
                blogMode: localStorage.getItem(BLOG_MODE_KEY) === 'true',
                completedSegments: new Set()
            };

            const segmentStatus = SEGMENTS.map(() => 'pending');

            const timeProvider = window.__ACT2_TIME_PROVIDER__ || new TimeProvider();

            const singaporeClock = document.getElementById('singaporeClock');
            const belgradeClock = document.getElementById('belgradeClock');
            const messageDisplay = document.getElementById('messageDisplay');
            const messageText = document.getElementById('messageText');
            const ringElement = document.getElementById('receiveRing');
            const frontRing = document.getElementById('frontRing');
            const circleElement = document.getElementById('distantCircle');
            const backgroundUniverse = document.querySelector('.background-universe');
            const energyElement = document.querySelector('.distant-energy');
            const runeElements = Array.from(document.querySelectorAll('.rune'));
            const blogPost = document.getElementById('blogPost');
            const blogContent = document.getElementById('blogContent');
            const shootingContainer = document.getElementById('shootingContainer');
            const starsContainer = document.getElementById('stars');

            const moonController = new MoonController(backgroundUniverse, circleElement, energyElement);
            const ringController = new RingController(ringElement, circleElement);
            const queueManager = new QueueManager(deliverQueuedSegment);

            const singaporeFormatter = new Intl.DateTimeFormat('en-GB', {
                timeZone: SGT_TIMEZONE,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
            const belgradeFormatter = new Intl.DateTimeFormat('en-GB', {
                timeZone: BELGRADE_TIMEZONE,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });

            function createStars() {
                if (!starsContainer) {
                    return;
                }
                const totalStars = 120;
                for (let i = 0; i < totalStars; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    const depthRoll = Math.random();
                    if (depthRoll < 0.5) {
                        star.classList.add('far');
                        const size = Math.random() * 1.5 + 0.3;
                        star.style.width = size + 'px';
                        star.style.height = size + 'px';
                    } else if (depthRoll < 0.85) {
                        star.classList.add('mid');
                        const size = Math.random() * 2 + 0.8;
                        star.style.width = size + 'px';
                        star.style.height = size + 'px';
                    } else {
                        star.classList.add('near');
                        const size = Math.random() * 2.5 + 1.5;
                        star.style.width = size + 'px';
                        star.style.height = size + 'px';
                    }
                    star.style.left = Math.random() * 100 + '%';
                    star.style.top = Math.random() * 100 + '%';
                    star.style.animationDelay = Math.random() * 4 + 's';
                    starsContainer.appendChild(star);
                }
            }

            function updateClocks() {
                if (!state.currentTime) {
                    return;
                }
                singaporeClock.textContent = singaporeFormatter.format(state.currentTime);
                belgradeClock.textContent = belgradeFormatter.format(state.currentTime);
            }

            function showGhostQuote() {
                if (state.blogMode) {
                    return;
                }
                const quote = ghostQuotes[Math.floor(Math.random() * ghostQuotes.length)];
                const element = document.createElement('div');
                element.className = 'ghost-quote';
                element.textContent = quote;
                element.style.top = Math.random() * 60 + 20 + '%';
                element.style.left = Math.random() * 50 + 25 + '%';
                document.body.appendChild(element);
                requestAnimationFrame(() => {
                    element.style.transition = 'opacity 4s ease-in';
                    element.style.opacity = (Math.random() * 0.12 + 0.05).toFixed(2);
                });
                setTimeout(() => {
                    element.style.transition = 'opacity 4s ease-out';
                    element.style.opacity = '0';
                    setTimeout(() => element.remove(), 4000);
                }, 12000);
            }

            function startGhostQuotes() {
                showGhostQuote();
                state.ghostInterval = setInterval(showGhostQuote, 15000);
            }

            function stopGhostQuotes() {
                if (state.ghostInterval) {
                    clearInterval(state.ghostInterval);
                    state.ghostInterval = null;
                }
            }

            function activateBloodMoon() {
                if (state.bloodMoonActive || state.blogMode) {
                    return;
                }
                state.bloodMoonActive = true;
                state.bloodMoonActivated = true;
                document.body.classList.add('red-mode');
                moonController.setHiddenImmediate();
                ringController.setAvailable(false);
                startShootingRings();
            }

            function deactivateBloodMoon() {
                if (!state.bloodMoonActive) {
                    return;
                }
                state.bloodMoonActive = false;
                document.body.classList.remove('red-mode');
                stopShootingRings();
            }

            function startShootingRings() {
                if (state.shootingInterval) {
                    return;
                }
                state.shootingInterval = setInterval(() => {
                    const ring = document.createElement('div');
                    ring.className = 'shooting-ring';
                    ring.style.left = Math.random() * 80 + 10 + '%';
                    ring.style.top = '-140px';
                    shootingContainer.appendChild(ring);
                    setTimeout(() => ring.remove(), 2500);
                }, 500);
            }

            function stopShootingRings() {
                if (state.shootingInterval) {
                    clearInterval(state.shootingInterval);
                    state.shootingInterval = null;
                }
                shootingContainer.innerHTML = '';
            }

            function updateBloodMoon() {
                if (!state.currentTime) {
                    return;
                }
                if (!state.bloodMoonActivated && state.currentTime >= BLOOD_MOON_END) {
                    state.bloodMoonActivated = true;
                    return;
                }
                if (!state.bloodMoonActive && !state.blogMode && state.currentTime >= BLOOD_MOON_START && state.currentTime < BLOOD_MOON_END) {
                    activateBloodMoon();
                }
                if (state.bloodMoonActive && state.currentTime >= BLOOD_MOON_END) {
                    deactivateBloodMoon();
                }
            }

            function buildInitialQueue() {
                if (state.blogMode || state.initialQueueBuilt || !state.currentTime) {
                    return;
                }
                const overdue = [];
                SEGMENT_TIMES.forEach((segmentTime, index) => {
                    if (segmentStatus[index] === 'completed') {
                        return;
                    }
                    if (index === 3) {
                        if (state.currentTime >= segmentTime) {
                            overdue.push(index);
                        }
                        return;
                    }
                    if (state.currentTime >= segmentTime) {
                        overdue.push(index);
                    }
                });
                if (overdue.length > 0) {
                    overdue.sort((a, b) => SEGMENT_TIMES[a] - SEGMENT_TIMES[b]);
                    overdue.forEach(index => {
                        segmentStatus[index] = 'queued';
                    });
                    queueManager.enqueue(overdue);
                }
                state.initialQueueBuilt = true;
            }

            function makeSegmentAvailable(index) {
                if (state.blogMode) {
                    return;
                }
                segmentStatus[index] = 'available';
                state.availableSegment = index;
                ringController.setAvailable(true);
                moonController.showFull();
            }

            async function deliverQueuedSegment(index) {
                if (state.blogMode) {
                    return;
                }
                makeSegmentAvailable(index);
                await moonController.playFinale(scaled(10000));
                if (state.availableSegment === index && !state.blogMode) {
                    await startSegmentDelivery(index, { queued: true });
                }
            }

            function updateUpcomingSegments() {
                if (state.blogMode || !state.currentTime) {
                    return;
                }

                if (state.availableSegment !== null) {
                    return;
                }

                let nextIndex = null;
                let nextTime = null;

                for (let i = 0; i < SEGMENTS.length; i++) {
                    if (segmentStatus[i] === 'completed' || segmentStatus[i] === 'queued' || queueManager.has(i)) {
                        continue;
                    }
                    const segmentTime = SEGMENT_TIMES[i];
                    if (state.currentTime >= segmentTime) {
                        if (segmentStatus[i] === 'pending') {
                            if (i === 3) {
                                const withinExactWindow = state.currentTime >= segmentTime && state.currentTime < new Date(segmentTime.getTime() + 60000);
                                if (withinExactWindow) {
                                    makeSegmentAvailable(i);
                                }
                            } else {
                                makeSegmentAvailable(i);
                            }
                        }
                        continue;
                    }
                    if (nextTime === null || segmentTime < nextTime) {
                        nextIndex = i;
                        nextTime = segmentTime;
                    }
                }

                if (state.availableSegment !== null) {
                    return;
                }

                if (nextIndex !== null) {
                    const diff = nextTime.getTime() - state.currentTime.getTime();
                    if (diff <= 3600000) {
                        moonController.startLongPhase(nextIndex, nextTime, state.currentTime);
                    } else {
                        moonController.clearLongPhase();
                    }
                } else {
                    moonController.clearLongPhase();
                }
            }

            function wait(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            function scaled(ms) {
                const scale = typeof window.__ACT2_TIME_SCALE__ === 'number' ? window.__ACT2_TIME_SCALE__ : 1;
                return Math.max(0, ms * scale);
            }

            async function runGibberish(duration) {
                const characters = 'αβγδεζηθικλμνξοπρστυφχψω∴∵∞∑∏∫√∂∇ᚠᚢᚦᚨᚱᚲᚷᚹᚺᚾᛁᛃᛇᛈᛉᛊᛏᛒᛖᛗᛚᛜᛞᛟ';
                const interval = setInterval(() => {
                    let gibberish = '';
                    for (let i = 0; i < 8; i++) {
                        const lineLength = Math.floor(Math.random() * 30) + 40;
                        let line = '';
                        for (let j = 0; j < lineLength; j++) {
                            line += characters[Math.floor(Math.random() * characters.length)];
                        }
                        gibberish += line + '
';
                    }
                    messageText.textContent = gibberish.trimEnd();
                }, 80);
                await wait(duration);
                clearInterval(interval);
            }

            function waitForMessageClose(timeout) {
                return new Promise(resolve => {
                    let resolved = false;
                    const handleClick = () => {
                        if (messageDisplay.dataset.closeable === 'true' && !resolved) {
                            resolved = true;
                            cleanup();
                            resolve();
                        }
                    };
                    const timer = setTimeout(() => {
                        if (!resolved) {
                            resolved = true;
                            cleanup();
                            resolve();
                        }
                    }, timeout);
                    function cleanup() {
                        messageDisplay.removeEventListener('click', handleClick);
                        clearTimeout(timer);
                    }
                    messageDisplay.addEventListener('click', handleClick);
                });
            }

            function closeMessageOverlay() {
                messageDisplay.classList.remove('active');
                messageDisplay.dataset.closeable = 'false';
                messageDisplay.style.cursor = 'default';
                messageText.textContent = '';
            }

            async function revealRune(index) {
                const rune = runeElements[index];
                if (!rune) {
                    return;
                }
                rune.classList.add('visible');
                rune.classList.add('dramatic-reveal');
                await wait(scaled(3000));
                rune.classList.remove('dramatic-reveal');
                rune.classList.add('permanent-glow');
            }

            async function startSegmentDelivery(index, options = {}) {
                if (state.blogMode || state.isMessageActive) {
                    return;
                }
                state.isMessageActive = true;
                state.availableSegment = null;
                if (!options.fromRune) {
                    segmentStatus[index] = 'delivering';
                }
                ringController.setAvailable(false);
                moonController.setHiddenImmediate();

                messageDisplay.classList.add('active');
                messageDisplay.dataset.closeable = 'false';
                messageDisplay.style.cursor = 'default';
                messageText.textContent = '';

                await runGibberish(scaled(3000));

                messageText.style.animation = 'messageShake 0.4s ease-in-out';
                await wait(scaled(400));
                messageText.style.animation = '';
                messageText.textContent = SEGMENTS[index].text;

                messageDisplay.dataset.closeable = 'true';
                messageDisplay.style.cursor = 'pointer';

                const autoClose = scaled(options.fromRune ? 300000 : 120000);
                await waitForMessageClose(autoClose);

                closeMessageOverlay();
                state.isMessageActive = false;

                if (options.fromRune) {
                    moonController.setHiddenImmediate();
                    return;
                }

                await revealRune(index);
                segmentStatus[index] = 'completed';
                state.completedSegments.add(index);
                moonController.setHiddenImmediate();

                if (index === 3) {
                    activateBlogMode();
                    return;
                }

                updateUpcomingSegments();
            }

            function openRuneSegment(index) {
                if (segmentStatus[index] !== 'completed' || state.isMessageActive) {
                    return;
                }
                startSegmentDelivery(index, { fromRune: true });
            }

            function activateBlogMode(initial = false) {
                if (state.blogMode && !initial) {
                    return;
                }
                state.blogMode = true;
                localStorage.setItem(BLOG_MODE_KEY, 'true');
                document.body.classList.add('blog-mode');
                deactivateBloodMoon();
                queueManager.clear();
                ringController.setAvailable(false);
                moonController.setHiddenImmediate();
                stopGhostQuotes();
                closeMessageOverlay();
                populateBlogContent();
                segmentStatus.fill('completed');
            }

            function populateBlogContent() {
                if (blogContent.dataset.loaded === 'true') {
                    return;
                }
                blogContent.innerHTML = '';
                SEGMENTS.forEach(segment => {
                    const sections = segment.text.split('

');
                    sections.forEach((section, idx) => {
                        if (idx === 0) {
                            const h2 = document.createElement('h2');
                            h2.textContent = section;
                            blogContent.appendChild(h2);
                        } else if (section.includes('Majko što')) {
                            const chant = document.createElement('div');
                            chant.className = 'chant';
                            chant.textContent = section;
                            blogContent.appendChild(chant);
                        } else {
                            const p = document.createElement('p');
                            p.textContent = section;
                            blogContent.appendChild(p);
                        }
                    });
                });
                blogContent.dataset.loaded = 'true';
            }

            async function tick() {
                state.currentTime = await timeProvider.getCurrentTime();
                updateClocks();

                if (state.blogMode) {
                    return;
                }

                updateBloodMoon();
                buildInitialQueue();
                updateUpcomingSegments();
                moonController.update(state.currentTime);
                queueManager.process();
            }

            function setupRunes() {
                runeElements.forEach((rune, index) => {
                    rune.addEventListener('click', () => openRuneSegment(index));
                });
            }

            function setupRing() {
                frontRing.addEventListener('click', () => {
                    if (state.availableSegment !== null && !state.isMessageActive && !state.blogMode) {
                        startSegmentDelivery(state.availableSegment);
                    }
                });
            }

            window.__ACT2_DEBUG__ = {
                state,
                segmentStatus,
                queueManager,
                moonController,
                ringController,
                timeProvider,
                tick
            };

            window.addEventListener('load', async () => {
                createStars();
                setupRunes();
                setupRing();

                if (state.blogMode) {
                    activateBlogMode(true);
                }

                state.currentTime = await timeProvider.getCurrentTime();
                updateClocks();

                if (!state.blogMode) {
                    buildInitialQueue();
                    updateUpcomingSegments();
                    moonController.update(state.currentTime);
                    startGhostQuotes();
                }

                if (!window.__ACT2_DISABLE_AUTOTICK__) {
                    setInterval(() => {
                        tick().catch(() => {});
                    }, 1000);
                }
            });
        })();
    </script>

</body>
</html>
